"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.hashCar = exports.listFilesAndCidsInCar = exports.listRootsInCar = exports.listCidsInCar = exports.listFilesInCar = void 0;
const fs_1 = __importDefault(require("fs"));
const car_1 = require("@ipld/car");
const cid_1 = require("multiformats/cid");
const sha2_1 = require("multiformats/hashes/sha2");
const index_1 = require("../unpack/index");
async function listFilesInCar({ input }) {
    const carReader = await car_1.CarIndexedReader.fromFile(input);
    for await (const file of (0, index_1.unpack)(carReader)) {
        // tslint:disable-next-line: no-console
        console.log(file.path);
    }
}
exports.listFilesInCar = listFilesInCar;
async function listCidsInCar({ input }) {
    const carIterator = await car_1.CarCIDIterator.fromIterable(fs_1.default.createReadStream(input));
    for await (const cid of carIterator) {
        // tslint:disable-next-line: no-console
        console.log(cid.toString());
    }
}
exports.listCidsInCar = listCidsInCar;
async function listRootsInCar({ input }) {
    const carIterator = await car_1.CarCIDIterator.fromIterable(fs_1.default.createReadStream(input));
    const roots = await carIterator.getRoots();
    for (const root of roots) {
        // tslint:disable-next-line: no-console
        console.log(root.toString());
    }
}
exports.listRootsInCar = listRootsInCar;
async function listFilesAndCidsInCar({ input }) {
    const carReader = await car_1.CarIndexedReader.fromFile(input);
    for await (const file of (0, index_1.unpack)(carReader)) {
        // tslint:disable-next-line: no-console
        console.log(`${file.cid.toString()} ${file.path}`);
    }
}
exports.listFilesAndCidsInCar = listFilesAndCidsInCar;
// cid code
const carCode = 0x0202;
async function hashCar({ input }) {
    const bytes = await fs_1.default.promises.readFile(input);
    // tslint:disable-next-line: no-console
    console.log(cid_1.CID.createV1(carCode, await sha2_1.sha256.digest(bytes)).toString());
}
exports.hashCar = hashCar;
